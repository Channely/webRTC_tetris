<div ng-include="'partials/navbar'"></div>

<h3>Your Peer ID: {{my_id}}</h3>
<!-- Steps -->
<div class="pure-u-1-3">
  <h2>PeerJS Video Chat</h2>

  <!-- Get local audio/video stream -->
  <div id="step1">
    <p>Please click `allow` on the top of the screen so we can access your webcam and microphone for calls.</p>
    <div id="step1-error">
      <p>Failed to access the webcam and microphone. Make sure to run this demo on an http server and click allow when asked for permission by the browser.</p>
      <a href="#" class="pure-button pure-button-error" id="step1-retry">Try again</a>
    </div>
  </div>

  <input ng-model="remotePeerId" type="text" placeholder="Enter remote peer id!">
  <button ng-click="callPeer()">Call Peer</button>

  <input ng-model="dataToSend" type="text" placeholder="Data to send" ng-change="sendData()">
  <button ng-click="sendData()">Send Data</button>

  <!-- Make calls to others -->
  <div id="step2">
    <p>Your id: <span id="my-id">...</span></p>
    <p>Share this id with others so they can call you.</p>
    <h3>Make a call</h3>
    <div class="pure-form">
      <input type="text" placeholder="Call user id..." id="callto-id">
      <a href="#" class="pure-button pure-button-success" id="make-call">Call</a>
    </div>
  </div>

  <!-- Call in progress -->
  <div id="step3">
    <p>Currently in call with <span id="their-id">...</span></p>
    <p><a href="#" class="pure-button pure-button-error" id="end-call">End call</a></p>
  </div>
</div>

<p id="start"><a href="javascript:play();">Press Space to Play.</a></p>
<div class="container">
  <div class="row">

    <div class="col-md-6 no-pad">
      <div>
        <canvas id="my-video-canvas"style="display:none"></canvas>
        <video id="my-video" autoplay loop></video>
        <canvas id="my-overlay"></canvas>
        <canvas id="my-gamecanvas"></canvas>
      </div>
    </div>

    <div class="col-md-6 no-pad">
      <div>
        <canvas id="their-video-canvas"style="display:none"></canvas>
        <video id="their-video" ng-src="{{peerURL}}" autoplay></video>
        <canvas id="their-overlay"></canvas>
        <canvas id="their-gamecanvas"></canvas>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-md-6 no-pad">
      <div id="menu">
        <p><canvas id="upcoming"></canvas></p>
        <p>score <span id="score">00000</span></p>
        <p>rows <span id="rows">0</span></p>
      </div>
    </div>

    <div class="col-md-6 no-pad">
      <div id="menu">
        <p><canvas id="their-upcoming"></canvas></p>
        <p>score <span id="their-score">00000</span></p>
        <p>rows <span id="their-rows">0</span></p>
      </div>
    </div>
  </div>
</div>



<canvas id="debug" width="640" height="480"></canvas>
<button id="startbutton">Take photo</button>

<!-- <img src="http://placekitten.com/g/320/261" id="photo" alt="photo"> -->

peerurl {{peerURL}}

<p id='gUMMessage'></p>
<p>Status : <span id='headtrackerMessage'></span></p>
<p><input type="button" onclick="htracker.stop();htracker.start();" value="reinitiate facedetection"></input>
<br/><br/>
<input type="checkbox" onclick="showProbabilityCanvas()" value="asdfasd"></input>Show probability-map</p>


<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <h1>Sent Data</h1>
      <p>{{dataToSend}}</p>
    </div>
    <div class="col-md-6">
      <h1>Received Data</h1>
      <p>{{receivedData}}</p>
    </div>
  </div>
</div>


<script>
  function drawRectangle(canvasInput, overlayContext, event) {
    overlayContext.clearRect(0,0,canvasInput.width, canvasInput.height);
    // once we have stable tracking, draw rectangle
    if (event.detection == "CS") {
      overlayContext.translate(event.x, event.y)
      overlayContext.rotate(event.angle-(Math.PI/2));
      overlayContext.strokeStyle = event.style || "#BADA55";
      overlayContext.strokeRect((-(event.width/2)) >> 0, (-(event.height/2)) >> 0, event.width, event.height/1.2);
      overlayContext.rotate((Math.PI/2)-event.angle);
      overlayContext.translate(-event.x, -event.y);
    }
  }
</script>

<script src="scripts/vendor/stats.js"></script>
<script src="scripts/tetris.js"></script>
<script src="scripts/drawOtherTetris.js"></script>
<div class="footer">
  <p>â™¥ from the Yeoman team</p>
</div>
